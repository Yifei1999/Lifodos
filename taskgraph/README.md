# 任务图（TaskGraph）使用说明

## 概述

taskgraph 是参照 langgraph 框架的调用思路，开发的异步任务流程编排框架。在将**任务函数**与**任务结点**（task）绑定后，用户可以通过类似 networkx 的 API 构建图模型，使用**状态量** （state）在任务结点间传递，记录实例的状态。

## 功能

基本概念：

- 任务图、任务结点：任务图是由结点相互连结而成的有向图。一个实例运行总是从起始结点开始，每个结点执行完毕后会选择性触发与之相连的下游结点，最终执行到终止结点，实例结束。
- 状态量（state）：任务结点间通过状态量传递参数，状态量是一个封装成字典的键值对参数列表。
- 任务函数：每个任务结点需要与一个任务函数绑定。任务函数由用户定义，入参和出参均为状态量（state）；除了任务函数外，任务结点还需要一个自行定义的**任务名称**作为唯一标识。

功能特性：

- 框架为异步框架。适合于 LLM 调用等 IO 密集型异步任务函数的执行
- 支持下游任务选择性触发。可以根据上游任务配置的参数，选择性地触发下游任务；同时可以支持充分、必要等触发条件
- 支持状态分发和任务并发执行。上游任务结束后，可以同时触发多个任务
- 支持状态收集。从多个完成的任务收集状态量，状态量融合后触发下游任务


## 使用方法

首先需要定义任务图的状态量，修改 `State` 类的变量，增加新的字段类型。`State` 预先定义的变量有：

- `downstream_disables` ： 用于定义下游任务的关闭。如果下游某个任务不需要执行，可以将其名称添加到这个变量的集合中
- `paras` ：用于上下游任务传递参数。建议将仅在两个任务间传递的参数，存放于 `paras` ；对于任务经常使用的参数，建议不放入 `para`


## 未来方案

* [ ] 完善充分触发条件下的任务执行
* [ ] para 的 merge 策略

## 开发历史
